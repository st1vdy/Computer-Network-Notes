# 三次握手和四次挥手

## 三次握手

![tcp-三次握手](../../../计算机网络/第五章-运输层/pics/tcp-三次握手.png)

如图，三次握手建立连接时，客户会先发送 `SYN = 1` 的报文（开始同步）给服务器；服务器接受到建立连接的请求后，会回复一个 `SYN = 1, ACK = 1` 的报文确认请求，并且**该报文的确认号是前一个报文的序号+1**；客户收到该报文后，回复应答报文 `ACK = 1`，建立连接，并且该报文的确认号是对服务器报文的确认，即 `ack = y + 1`。



## 四次挥手

![tcp-四次挥手](../../../计算机网络/第五章-运输层/pics/tcp-四次挥手.png)

tcp释放连接时，客户先发送释放连接的请求报文，该报文需要 `FIN = 1, ACK = 1`（只要建立了连接，ACK都=1）；服务器收到请求后，会做出回复，发送一个 `ACK=1` 的报文；等待服务器完成关闭连接的迁至操作后，发送最终的确认报文 `FIN = 1, ACK = 1`；客户收到报文后确认，回复 `ACK = 1`，等待2MSL的时间后关闭连接。



## 例题

> 主机甲向主机乙发送一个(SYN=1,seq=11220)的TCP段，期望与主机乙建立TCP连接，若主机乙接受该连接请求，则主机乙向主机甲发送的正确的TCP段应该是（）
>
> 1. (SYN=1,ACK=1,seq=11220,ack=11220)
> 2. (SYN=1,ACK=1,seq=11221,ack=11221)
> 3. (SYN=0,ACK=0,seq=11221,ack=11221)
> 4. (SYN=0,ACK=1,seq=11220,ack=11220)

选项2正确。